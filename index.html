<html lang="en" ng-app="demoApp"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="homepage">
    <meta name="author" content="akhil">
    <link rel="shortcut icon" href="./images/icon.png">

    <title>Large-Scale Image Memorability</title>

    <!-- Bootstrap core CSS -->
    <link href="./css/bootstrap.css" rel="stylesheet">
    <link href="./css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Custom styles for this template -->
		<link href="./css/index.css" rel="stylesheet">
		<link href="./css/questionMark.css" rel="stylesheet">
    <!--<link href="./css/commmon.css" rel="stylesheet">-->
    <link rel="stylesheet" href="./css/dropzone.css">
    <link href='http://fonts.googleapis.com/css?family=Raleway:600,300' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- some good ol' javascript resources -->
    <script src="./assets/js/jquery.js"></script>
    <script src="./js/angular.min.js"></script>
    <script src="./js/controllers.js"></script>
    <script src="./js/dropzone.js"></script>
    <script src="js/load-image.all.min.js"></script>
    <script>
    var recognitionResult = null;
    var imageHeight = 0;
    var imageWidth  = 0;
    var maxWidth    = 100;
    var maxHeight   = 450;
    var imageScale  = 1;
    var dispHeight  = 450;
    var dispWidth   = 100;

    function scaleProperly(){
        if (imageHeight!=0 && imageWidth!=0){
            imageScale = Math.min((maxHeight-35)/imageHeight,(maxWidth-35)/imageWidth,1);
            dispHeight = Math.round(imageHeight * imageScale);
            dispWidth  = Math.round(imageWidth  * imageScale);
            $('#imageDiv').height(dispHeight+45);
            $('#imageDiv').width(dispWidth+35);
            $('#imageArea').height(dispHeight);
            $('#imageArea').width(dispWidth);
        }
    }
    function go(url) {
        $('#form')[0].reset();
        document.getElementById("url").value = url;
        $('#data').val('');
        // handleImage(url);
        submitForm();
        // $http.post('http://memorability.csail.mit.edu/cgi-bin/image.py', {'url': url}).success(
        //   function(data, status, headers, config) {
        //     // this callback will be called asynchronously
        //     // when the response is available
        //     console.log('got resposne')
        //   }).error(
        //   function(data, status, headers, config) {
        //     // called asynchronously if an error occurs
        //     // or server returns response with an error status.
        //   }); 
    }    
    function submitForm(){
        if ($('#url').val()!='http://'){
            // $("#imageArea").css('width', 'auto');
            // $("#imageArea").css('height', 'auto');
            $('#imageArea').attr('src', $('#url').val());
        }
        $('#imageDiv').show();
        $("#random").val(new Date().getTime());
        $("#resultArea").hide(); 
        $('#resultArea').html('');
        $("#statusText").html("<center>Computing... <img src='spinner.gif' /></center>");
        $("#statusText").show();
        $("#form").submit();
        //handleImage($('#url').val());

        
    }
    function selectFile(input) {
        if (input.files && input.files[0]) {
            console.log('in select file!!')
            var reader = new FileReader();
            $('#centerDiv').show();
            $('#url').val('http://');
            reader.onload = function (e) {
                $("#imageDiv").show();
                $("#imageArea").css('width', 'auto');
                $("#imageArea").css('height', 'auto');
                $("#imageArea").attr("src", e.target.result);
            }
            reader.readAsDataURL(input.files[0]);
            loadImage(input.files[0],
              function(img){
                $("#data").val(img.toDataURL("image/jpeg"));
                submitForm();
              },
              {maxWidth: 400, maxHeight: 400, canvas: true}
            );
        }
    }
    function handleImage(url) {
      angular.element($('#democontroller')).scope().handleImage(url);
    }
    function cmp(a, b) { 
        return b[1] - a[1];
    }
    var iframeCount = 0;
    function iframeLoaded(){
        iframeCount = iframeCount+1;
        if (iframeCount>1){
            recognitionResult = jQuery.parseJSON($("#resIframe").contents().find("body").html());

            if (recognitionResult.memscore==null){
              $("#statusText").html("<center>Error! Please refresh and try again.</center>");
            }else{
            var score_string = 'Error';
            var m = recognitionResult.memscore;
            if(m<0.3){
              score_string = 'Very Low';
            }else if(m<0.5){
              score_string = 'Low';
            }else if(m<0.7){
              score_string = 'Medium';
            }else if(m<0.9){
              score_string = 'High';
            }else{
              score_string = 'Very High';
            }

            $('#resultArea').html('<center><h1 style="margin-top:0px" id="score">Memorability: ' + score_string + '</h1><p></p><h3>(<a href="#score" style="text-decoration: none; color: black" class="questionMark">score: ' + m + ' <img src="imgs/questionMark.png" class="superimg"><span style="font-size: 14px; font-weight: normal"><img class="callout" src="imgs/callout_black.gif" /><strong>What this means</strong><br/><div align="justify">The score ranges from 0 to 1, where 1 is the most memorable. If the score is 0.5, we expect roughly 50% of people who view this image to remember it after 100 seconds of viewing the original image.</div></span></a>)</h3></center>');
              $("#statusText").hide(); 
              $("#resultArea").show(); 
            }
        }
    }

    // $(document).ready(function() { 
    //     maxWidth = $('#centerDiv').width();
    //     $(window).resize(function() { 
    //         maxWidth = $('#centerDiv').width();
    //         scaleProperly();
    //     });
    //     $('#imageArea').load(function() { 
    //         imageHeight = $('#imageArea').height();
    //         imageWidth  = $('#imageArea').width();
    //         scaleProperly();
    //     });
    //     //$("#demoblock").height($("#apiblock").height());
    // });    

    function runBtn(){
        var url = document.getElementById("url").value;
        $('#form')[0].reset();
        document.getElementById("url").value = url;
        $('#data').val('');
        submitForm();
    }

    function popup(mylink, windowname)
    {
      if (! window.focus)return true;
      var href;
      if (typeof(mylink) == 'string')
         href=mylink;
      else
         href=mylink.href;
      window.open(href, windowname, 'width=800,height=300,scrollbars=yes,menubar=no');
      return false;
    }
    </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../../assets/js/html5shiv.js"></script>
      <script src="../../assets/js/respond.min.js"></script>
    <![endif]-->
  <style id="holderjs-style" type="text/css">.holderjs-fluid {font-size:16px;font-weight:bold;text-align:center;font-family:sans-serif;margin:0}</style></head>
  <body ng-controller="DemoCtrl" id="democontroller">

    <div id="top-menu" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container" style="width: 75%;">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" style="font-size: 1.75em; font-family: 'Roboto Slab'; color: #A31F34;" href="">LaMem</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul id="topnav-links" class="nav navbar-nav">
            <li class="active"><a href=""><i class="fa fa-magic fa-fw" style="margin: 3px;"></i>Demo</a></li>
            <li><a href="explore.html"><i class="fa fa-th fa-fw" style="margin: 3px;"></i>Explore</a></li>
            <li><a href="download.html"><i class="fa fa-download fa-fw" style="margin: 3px;"></i>Download</a></li>
          </ul>
        </div><!--/.navbar-collapse -->
      </div>
    </div>

    <div id="page-heading" class="jumbotron">
      <div id="heading-text" class="container">
        <p class="big-text" style="">
          <span class="lamem-text" style="margin-right: 2px;">La</span>rge-scale Image <span class="lamem-text" style="margin-right: 2px;">Mem</span>orability
        </p>
        <p>
          <a href="http://people.csail.mit.edu/khosla">Aditya Khosla</a>, <a href="http://www.akhilr.com">Akhil Raju</a>, <a href="http://web.mit.edu/torralba/www/">Antonio Torralba</a>, <a href="http://cvcl.mit.edu/Aude.htm">Aude Oliva</a><br/>
          Massachusetts Institute of Technology
        </p>
      </div>
    </div>

    <div class="container" id="main-content">
      
      <div style=" width: 0px; height: 0px; overflow: hidden;" >

        <iframe src="" name="resIframe" id="resIframe" onload="iframeLoaded();" ></iframe>
      </div> 

      <div class="row" id="demo" style>

        <div class="col-md-4 col-sm-6">
          <div id="file-upload">
            <strong>How memorable is your image? Upload to find out!</strong>
            <!-- <form action="selectFile(this)" id="file_form" class="dropzone" style="margin-top: 10px; min-height: 50px;" onchange="selectFile(this);"></form> -->
            <form id="file_form">
              <input type="file" name="file_name" id="fileinput" onchange="selectFile(this);">
            </form>
            <b>or</b> enter an image url:
            <div class="form-group" style="margin-top: 10px;">
              <form action="http://memorability.csail.mit.edu/cgi-bin/image.py" id="form" method="post" enctype="multipart/form-data" target="resIframe">
                <input type="hidden" name="random" id="random" value="">
                <input type="hidden" name="data" id="data" value="">
                <input type="text" class="form-control" id="url" name="url" placeholder="Enter URL">
                <input type="button" value="Run" onClick="runBtn();">
              </form>
            </div>
            <b>or</b> choose one of these examples:
            <table align="center" style="margin-top: 5px;">
              <tr>
                <td><div class="img-container"><img src="imgs/1.jpg" onclick="go(this.src);"></div></td>
                <td><div class="img-container"><img src="imgs/2.jpg" onclick="handleImage(this.src); go(this.src);"></div></td>
                <td><div class="img-container"><img src="imgs/3.jpg" onclick="handleImage(this.src); go(this.src);"></div></td>
                <td><div class="img-container"><img src="imgs/5.jpg" onclick="go(this.src);"></div></td>
              </tr>
              <tr>
                <td><div class="img-container"><img src="imgs/6.jpg" class="portrait" onclick="go(this.src);"></div></td>
                <td><div class="img-container"><img src="imgs/7.jpg" onclick="go(this.src);"></div></td>
                <td><div class="img-container"><img src="imgs/8.jpg" class="portrait" onclick="go(this.src);"></div></td>
                <td><div class="img-container"><img src="imgs/9.jpg" onclick="go(this.src);"></div></td>
              </tr>
            </table> 
          </div>
        </div>

        <div class="col-md-8  col-sm-6" id="centerDiv" style="text-align: center; font-size: 1.5em;">
          <!-- <div id="centerDiv" class="content" style="display:none">
              <div id="imageDiv" oncontextmenu="javascript:return false;" >
                  <img id="imageArea" style="max-width: 100%; max-height: 100%;" />
              </div>
              <div style="text-align: left; ">
                <center><h1 id="statusText" style="display:none;">Computing... <img src="spinner.gif" /></h1></center>
                <div id="resultArea">
                </div>
              </div>
          </div> -->
          <div id="imageDiv" style="margin-top: 7px; float: center; display: none;">
            <img id="imageArea" src="imgs/1.jpg" style="max-width: 100%; max-height: 100%;"></img><br/>
            <div style="text-align: left; ">
                <center><h1 id="statusText" style="display:none;">Computing... <img src="spinner.gif" /></h1></center>
                <div id="resultArea">
                </div>
              </div>
          </div>
        </div>

      </div> <!-- end demo row -->

      <hr/>

      <div class="row">
        <div class="col-md-6" style="">
            <div class="row" style="padding-top: 0px;">
              <span class="section-header">
                Download our paper
              </span>
            </div>
            <hr style="padding-top: 0px; padding-bottom: 0px; margin: 0px;">
            <div class="row">
              <p>
                Please cite the following paper if you use this service:<br/>
                <i>Understanding and Predicting Image Memorability at a Large Scale</i><br/>
                A. Khosla, A. S. Raju, A. Torralba and A. Oliva
              </p>
            </div>
            <div class="row" style="padding-top: 0px;">
              <a href="#" class="btn btn-reference"><i class="fa fa-file-pdf-o" style="margin: 3px;"></i>PDF</a>
              <a href="#" class="btn btn-reference"><i class="fa fa-book" style="margin: 3px;"></i>Bibtex</a>
            </div>
        </div>

        <div class="col-md-6" style="">
            <div class="row" style="padding-top: 0px;">
              <span class="section-header">
                Image Memorability API
              </span>
            </div>
            <hr style="padding-top: 0px; padding-bottom: 0px; margin: 0px;">
            <div class="row">
              <p>
                <b>Usage:</b> http://memorability.csail.mit.edu/cgi-bin/image.py?url=IMG_URL<br/>
                <br/>
                <b>Example:</b>
                <a href="http://memorability.csail.mit.edu/cgi-bin/image.py?url=
                http://memorability.csail.mit.edu/demo/1.jpg">http://memorability.csail.mit.edu/cgi-bin/image.py?url=
                http://memorability.csail.mit.edu/demo/1.jpg</a> <br/>
                <br/>
                <b>Notice:</b> Please do not overload our server by querying repeatedly in a short period of time. This is a free service for academic research and education purposes only. It has no guarantee of any kind. For any questions or comments regarding this API or potential commercial applications, please contact <a href="contact.html">Aditya Khosla</a>.
              </p>
          </div>
          
        </div>

      </div>

    </div>
      

      
    </div> <!-- ends container for sections -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./js/bootstrap.min.js"></script>
  

</body></html>
